<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: NSDocument
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!NSDocument.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (N)</a> &raquo;
    
    
    <span class="title">NSDocument</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: NSDocument
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">NSDocument</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Lotus::Entity, <span class='object_link'><a href="NSDocument/Presentation.html" title="NSDocument::Presentation (module)">Presentation</a></span>, <span class='object_link'><a href="NSDocument/Setup.html" title="NSDocument::Setup (module)">Setup</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/noteshare/entities/ns_document.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>An instance of the Document class has <strong>content</strong>, a block of
text, various metadata – <strong>title</strong>, <strong>author</strong>,
<strong>tags</strong> etc. – and a set of links.  First, there is
<strong>subdoc_refs</strong>, an array of *id&#39;s* of Documents.  The
idea is that the text of document is composed of its content plus the
content of it subdocuments. Subdocuments can have their own subdocuments,
and so on. The <strong>compile</strong> method assembles the content of a
document, its subdocuments, etc., in the proper order.   Second, there is
<strong>doc_refs</strong>, which is a hash that could look like this:</p>

<p>{ &#39;previous&#39;: 124, &#39;next&#39;: 201, &#39;comments&#39;: 444,
&#39;summary&#39;: 555 }</p>

<p>The <strong>previous</strong> and <strong>next</strong> keys are used by an
editor for navigation. Keys like <strong>comment</strong> and
<strong>summary</strong> point to little documents that may or may not not
be compiled into the main text.  There is also a set of special pointers,
<strong>parent_id</strong> and <strong>index_in_parent</strong>. Suppose
that document 123 refers to document 555 via the  element of index two in
its <strong>subdoc_refs</strong> array, e.g.,</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>21</span><span class='comma'>,</span> <span class='int'>19</span><span class='comma'>,</span> <span class='int'>555</span><span class='comma'>,</span> <span class='int'>56</span><span class='rbracket'>]</span>
</code></pre>

<p>Then the parent_id of document 555 is 123 and the value of index_in_parent
is 2.</p>

<p>The subdoc array is populated by the method <strong>insert</strong>. To
illustrate, suppose we have documents @article, @section1, @section2, and
@section3.  The succession of method calls</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@section1</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='ivar'>@article</span><span class='rparen'>)</span>
<span class='ivar'>@section2</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='int'>1</span><span class='comma'>,</span> <span class='ivar'>@article</span><span class='rparen'>)</span>
<span class='ivar'>@section2</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='int'>2</span><span class='comma'>,</span> <span class='ivar'>@article</span><span class='rparen'>)</span>
</code></pre>

<p>builds up the subdoc array of @article and manages the pointers parent_id,
index_in_parent, previous and next.</p>

<pre class="code ruby"><code class="ruby">CONTENTS

   1. REQUIRE, INCLUDE, AND INITIALIZE</code></pre>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="NSDocument/Presentation.html" title="NSDocument::Presentation (module)">Presentation</a></span>, <span class='object_link'><a href="NSDocument/Setup.html" title="NSDocument::Setup (module)">Setup</a></span>
    
  
    
  
</p>

  <h2>Constant Summary</h2>
  



  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="NSDocument/Presentation.html" title="NSDocument::Presentation (module)">Presentation</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NSDocument/Presentation.html#SERVER_NAME-constant" title="NSDocument::Presentation::SERVER_NAME (constant)">Presentation::SERVER_NAME</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#SERVER_PORT-constant" title="NSDocument::Presentation::SERVER_PORT (constant)">Presentation::SERVER_PORT</a></span></p>





  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_to-instance_method" title="#add_to (instance method)">- (Object) <strong>add_to</strong>(parent_document) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>@section.add_to(@article) makes @section the last subdocument of @article.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#associate_as-instance_method" title="#associate_as (instance method)">- (Object) <strong>associate_as</strong>(type, doc) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>@foo.associate(&#39;summary&#39;, @bar) associats @foo to @bar as a
&#39;summary&#39;.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#associated_document-instance_method" title="#associated_document (instance method)">- (Object) <strong>associated_document</strong>(type) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>@foo.associatd_document(&#39;summary&#39;) retrieve the document associated
to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compile-instance_method" title="#compile (instance method)">- (Object) <strong>compile</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p><strong>doc.compile</strong> concatenates the contents of
<strong>doc</strong> with the compiled text of each section of
<strong>doc</strong>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compile_with_render-instance_method" title="#compile_with_render (instance method)">- (Object) <strong>compile_with_render</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Compile the receiver, render it, and store the rendered text in
self.compiled_and_rendered_content.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#info-instance_method" title="#info (instance method)">- (Object) <strong>info</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return title and id of NSDocument.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (NSDocument) <strong>initialize</strong>(hash) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>When initializing an NSDocument, ensure that certain fields have a standard
non-nil value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#insert-instance_method" title="#insert (instance method)">- (Object) <strong>insert</strong>(k, parent_document) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>@section(k, @article) makes @section the k-th subdocument of @article.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#move_to-instance_method" title="#move_to (instance method)">- (Object) <strong>move_to</strong>(new_position) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>@foo.move_to(7) moves @foo in its parent document to position 7.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#next_document-instance_method" title="#next_document (instance method)">- (Object) <strong>next_document</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return next NSDocument.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#next_id-instance_method" title="#next_id (instance method)">- (Object) <strong>next_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Assume that receiver is subdocument k of parent.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parent-instance_method" title="#parent (instance method)">- (Object) <strong>parent</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p><strong>doc.parent</strong> returns nil or the parent object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#previous_document-instance_method" title="#previous_document (instance method)">- (Object) <strong>previous_document</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return previous NSDocument.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#previous_id-instance_method" title="#previous_id (instance method)">- (Object) <strong>previous_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Assume that receiver is subdocument k of parent.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_from_parent-instance_method" title="#remove_from_parent (instance method)">- (Object) <strong>remove_from_parent</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>It oes not delete @foo.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#render-instance_method" title="#render (instance method)">- (Object) <strong>render</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>NSDocument#render is the sole connection between class NSDocument and
module Render.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#root_document-instance_method" title="#root_document (instance method)">- (Object) <strong>root_document</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The root_document is what you get by following parent_document links to
their source.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_next_doc-instance_method" title="#set_next_doc (instance method)">- (Object) <strong>set_next_doc</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Use the information in self.parent.subdoc_refs to set the previous document
link.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_previous_doc-instance_method" title="#set_previous_doc (instance method)">- (Object) <strong>set_previous_doc</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Use the information in self.parent.subdoc_refs to set the previous document
link.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#status-instance_method" title="#status (instance method)">- (Object) <strong>status</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return title, id, an ids of previous and next documents.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#subdocument-instance_method" title="#subdocument (instance method)">- (Object) <strong>subdocument</strong>(k) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>*doc.subdocment(k)* returns the k-th subdocument of <strong>doc</strong>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_content-instance_method" title="#update_content (instance method)">- (Object) <strong>update_content</strong>(input = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If input is nil, render the content and save it in rendered_content.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_neighbors-instance_method" title="#update_neighbors (instance method)">- (Object) <strong>update_neighbors</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Used by #insert to preserve the validity of the previous and next links of
subdocuments.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_table_of_contents-instance_method" title="#update_table_of_contents (instance method)">- (Object) <strong>update_table_of_contents</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A table of contents is a list of lists, where the sublists are oof the form
[id, title].</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="NSDocument/Setup.html" title="NSDocument::Setup (module)">Setup</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NSDocument/Setup.html#seed_db-class_method" title="NSDocument::Setup.seed_db (method)">seed_db</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="NSDocument/Presentation.html" title="NSDocument::Presentation (module)">Presentation</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NSDocument/Presentation.html#document_map-instance_method" title="NSDocument::Presentation#document_map (method)">#document_map</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#link-instance_method" title="NSDocument::Presentation#link (method)">#link</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#next_document_title-instance_method" title="NSDocument::Presentation#next_document_title (method)">#next_document_title</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#next_link-instance_method" title="NSDocument::Presentation#next_link (method)">#next_link</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#parent_document_title-instance_method" title="NSDocument::Presentation#parent_document_title (method)">#parent_document_title</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#parent_link-instance_method" title="NSDocument::Presentation#parent_link (method)">#parent_link</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#previous_document_title-instance_method" title="NSDocument::Presentation#previous_document_title (method)">#previous_document_title</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#previous_link-instance_method" title="NSDocument::Presentation#previous_link (method)">#previous_link</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#root_link-instance_method" title="NSDocument::Presentation#root_link (method)">#root_link</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#subdocument_titles-instance_method" title="NSDocument::Presentation#subdocument_titles (method)">#subdocument_titles</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#table_of_contents-instance_method" title="NSDocument::Presentation#table_of_contents (method)">#table_of_contents</a></span>, <span class='object_link'><a href="NSDocument/Presentation.html#url-instance_method" title="NSDocument::Presentation#url (method)">#url</a></span></p>

  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="NSDocument (class)">NSDocument</a></span></tt>) <strong>initialize</strong>(hash) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>When initializing an NSDocument, ensure that certain fields have a standard
non-nil value</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='ivar'>@subdoc_refs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='ivar'>@subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@toc</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@doc_refs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='ivar'>@doc_refs</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='ivar'>@render_options</span> <span class='op'>||=</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>format</span><span class='tstring_end'>&#39;</span></span><span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>adoc</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
  <span class='ivar'>@root_document_id</span> <span class='op'>||=</span> <span class='int'>0</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_to-instance_method">
  
    - (<tt>Object</tt>) <strong>add_to</strong>(parent_document) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>@section.add_to(@article) makes @section the last subdocument of @article</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_to'>add_to</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_document'>parent_document</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="associate_as-instance_method">
  
    - (<tt>Object</tt>) <strong>associate_as</strong>(type, doc) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>@foo.associate(&#39;summary&#39;, @bar) associats @foo to @bar as a
&#39;summary&#39;. It can be retrieved as
@foo.associatd_document(&#39;summary&#39;)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


293
294
295
296
297
298</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_associate_as'>associate_as</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_doc_refs'>doc_refs</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_id'>parent_id</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_root_document_id'>root_document_id</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="associated_document-instance_method">
  
    - (<tt>Object</tt>) <strong>associated_document</strong>(type) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>@foo.associatd_document(&#39;summary&#39;) retrieve the document associated
to</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


303
304
305</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 303</span>

<span class='kw'>def</span> <span class='id identifier rubyid_associated_document'>associated_document</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_doc_refs'>doc_refs</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compile-instance_method">
  
    - (<tt>Object</tt>) <strong>compile</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p><strong>doc.compile</strong> concatenates the contents of
<strong>doc</strong> with the compiled text of each section of
<strong>doc</strong>.  The sections array is determined by #part, which is
a persistent array of integers which represent the id&#39;s of the sections
of <strong>doc</strong>.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


336
337
338
339
340
341
342
343
344
345
346
347
348</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 336</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compile'>compile</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span> <span class='op'>==</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_content'>content</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='id identifier rubyid_content'>content</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
      <span class='id identifier rubyid_section'>section</span> <span class='op'>=</span> <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_text'>text</span>  <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_compile'>compile</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='comment'># section.xcompile
</span>    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_text'>text</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compile_with_render-instance_method">
  
    - (<tt>Object</tt>) <strong>compile_with_render</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Compile the receiver, render it, and store the rendered text in
self.compiled_and_rendered_content</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


385
386
387
388
389
390
391
392
393
394
395
396
397</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 385</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_with_render'>compile_with_render</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@render_options[&#39;format&#39;] = </span><span class='embexpr_beg'>#{</span><span class='ivar'>@render_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>format</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='ivar'>@render_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>format</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>adoc</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_renderer'>renderer</span> <span class='op'>=</span> <span class='const'>Render</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_compile'>compile</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_compiled_and_rendered_content'>compiled_and_rendered_content</span> <span class='op'>=</span> <span class='id identifier rubyid_renderer'>renderer</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span>
  <span class='kw'>elsif</span> <span class='ivar'>@render_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>format</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>adoc-latex</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_renderer'>renderer</span> <span class='op'>=</span> <span class='const'>Render</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_compile'>compile</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='label'>backend:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html5</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span> <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_compiled_and_rendered_content'>compiled_and_rendered_content</span> <span class='op'>=</span> <span class='id identifier rubyid_renderer'>renderer</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_compiled_and_rendered_content'>compiled_and_rendered_content</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
  <span class='kw'>end</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="info-instance_method">
  
    - (<tt>Object</tt>) <strong>info</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return title and id of NSDocument</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 215</span>

<span class='kw'>def</span> <span class='id identifier rubyid_info'>info</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='embexpr_end'>}</span><span class='tstring_content'>:: id: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="insert-instance_method">
  
    - (<tt>Object</tt>) <strong>insert</strong>(k, parent_document) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>@section(k, @article) makes @section the k-th subdocument of @article.  The
subdocuments that were in position k and above are shifted to the right. 
This method updates all links: parent, index_in_parent, amd the relevant
next and previous links</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='rparen'>)</span>

  <span class='comment'># puts &quot;Insert #{self.id} (#{self.title}) at k = #{k}&quot;
</span>
  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span> <span class='op'>||</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span> <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_index_in_parent'>index_in_parent</span> <span class='op'>=</span>  <span class='id identifier rubyid_k'>k</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent_id'>parent_id</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_root_document_id'>root_document_id</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_root_document_id'>root_document_id</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_root_document_id'>root_document_id</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_root_document_id'>root_document_id</span>
  <span class='kw'>end</span>


  <span class='comment'># update index_in_parent for subdocuments
</span>  <span class='comment'># that were shifted to the right
</span>  <span class='comment'># puts &quot;Shifting ...&quot;
</span>  <span class='comment'># puts &quot;parent_document.subdoc_refs.tail(k+1): #{parent_document.subdoc_refs.tail(k)}&quot;
</span>  <span class='id identifier rubyid_parent_document'>parent_document</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_tail'>tail</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
    <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='id identifier rubyid_id'>id</span>
    <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_index_in_parent'>index_in_parent</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_index_in_parent'>index_in_parent</span> <span class='op'>+</span> <span class='int'>1</span>
    <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_persist'>persist</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span> <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_persist'>persist</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_persist'>persist</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_document'>parent_document</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_update_neighbors'>update_neighbors</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="move_to-instance_method">
  
    - (<tt>Object</tt>) <strong>move_to</strong>(new_position) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>@foo.move_to(7) moves @foo in its parent document to position 7.
Subdocuments that were in position 7 and up are moved up.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 192</span>

<span class='kw'>def</span> <span class='id identifier rubyid_move_to'>move_to</span><span class='lparen'>(</span><span class='id identifier rubyid_new_position'>new_position</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_remove_from_parent'>remove_from_parent</span>
  <span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_new_position'>new_position</span><span class='comma'>,</span> <span class='id identifier rubyid_parent'>parent</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="next_document-instance_method">
  
    - (<tt>Object</tt>) <strong>next_document</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return next NSDocument.  That is, if @foo, @bar, and @baz are subcocuments
in order of @article, then @bar.next_document = @baz</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_next_document'>next_document</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='id identifier rubyid_next_id'>next_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="next_id-instance_method">
  
    - (<tt>Object</tt>) <strong>next_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Assume that receiver is subdocument k of parent. Return the id of
subdocuemnt k + 1 or nil</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 207</span>

<span class='kw'>def</span> <span class='id identifier rubyid_next_id'>next_id</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_parent'>parent</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_index_in_parent'>index_in_parent</span><span class='op'>+</span><span class='int'>1</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='lbracket'>[</span><span class='id identifier rubyid_index_in_parent'>index_in_parent</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parent-instance_method">
  
    - (<tt>Object</tt>) <strong>parent</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p><strong>doc.parent</strong> returns nil or the parent object</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 258</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parent'>parent</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_parent_id'>parent_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="previous_document-instance_method">
  
    - (<tt>Object</tt>) <strong>previous_document</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return previous NSDocument.  That is, if @foo, @bar, and @baz are
subcocuments in order of @article, then @bar.previous_document = @foo</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 233</span>

<span class='kw'>def</span> <span class='id identifier rubyid_previous_document'>previous_document</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='id identifier rubyid_previous_id'>previous_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="previous_id-instance_method">
  
    - (<tt>Object</tt>) <strong>previous_id</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Assume that receiver is subdocument k of parent. Return the id of
subdocument k - 1 or nil</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_previous_id'>previous_id</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_index_in_parent'>index_in_parent</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_index_in_parent'>index_in_parent</span><span class='op'>-</span><span class='int'>1</span> <span class='op'>&lt;</span> <span class='int'>0</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='lbracket'>[</span><span class='id identifier rubyid_index_in_parent'>index_in_parent</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_from_parent-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_from_parent</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>It oes not delete @foo. Fixme: it is intended tht a document have at most
one parent. However, this is not yet enforced.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 160</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_from_parent'>remove_from_parent</span>
  <span class='id identifier rubyid_k'>k</span> <span class='op'>=</span> <span class='id identifier rubyid_index_in_parent'>index_in_parent</span>
  <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span>
  <span class='id identifier rubyid_pd'>pd</span> <span class='op'>=</span> <span class='id identifier rubyid_previous_document'>previous_document</span>
  <span class='id identifier rubyid_nd_id'>nd_id</span> <span class='op'>=</span> <span class='id identifier rubyid_next_document'>next_document</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_persist'>persist</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='rparen'>)</span>

  <span class='comment'># update index_in_parent for subdocuments
</span>  <span class='comment'># that were shifted to the left
</span>  <span class='comment'># puts &quot;Shifting ...&quot;
</span>  <span class='comment'># puts &quot;parent_document.subdoc_refs.tail(k+1): #{parent_document.subdoc_refs.tail(k)}&quot;
</span>  <span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_tail'>tail</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
    <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='id identifier rubyid_id'>id</span>
    <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_index_in_parent'>index_in_parent</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_index_in_parent'>index_in_parent</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_persist'>persist</span><span class='lparen'>(</span><span class='id identifier rubyid_doc'>doc</span> <span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_pd'>pd</span>
    <span class='id identifier rubyid_pd'>pd</span><span class='period'>.</span><span class='id identifier rubyid_set_next_doc'>set_next_doc</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_nd'>nd</span> <span class='op'>=</span>  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='id identifier rubyid_nd_id'>nd_id</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_nd'>nd</span>
    <span class='id identifier rubyid_nd'>nd</span><span class='period'>.</span><span class='id identifier rubyid_set_previous_doc'>set_previous_doc</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="render-instance_method">
  
    - (<tt>Object</tt>) <strong>render</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>NSDocument#render is the sole connection between class NSDocument and
module Render.  It updates self.rendered_content by applying
Asciidoctor.convert to self.content with the provided options.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


369
370
371
372
373
374
375
376
377
378
379
380
381</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 369</span>

<span class='kw'>def</span> <span class='id identifier rubyid_render'>render</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@render_options[&#39;format&#39;] = </span><span class='embexpr_beg'>#{</span><span class='ivar'>@render_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>format</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='ivar'>@render_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>format</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>adoc</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_renderer'>renderer</span> <span class='op'>=</span> <span class='const'>Render</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rendered_content'>rendered_content</span> <span class='op'>=</span> <span class='id identifier rubyid_renderer'>renderer</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span>
  <span class='kw'>elsif</span> <span class='ivar'>@render_options</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>format</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>adoc-latex</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_renderer'>renderer</span> <span class='op'>=</span> <span class='const'>Render</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='label'>backend:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html5</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span> <span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rendered_content'>rendered_content</span> <span class='op'>=</span> <span class='id identifier rubyid_renderer'>renderer</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span>
  <span class='kw'>else</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
  <span class='kw'>end</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="root_document-instance_method">
  
    - (<tt>Object</tt>) <strong>root_document</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The root_document is what you get by following parent_document links to
their source. If the root_document_id is zero, then the document is a root
document. Otherwise, the root_document_id is the id of the root_documment.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


275
276
277
278
279
280
281</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 275</span>

<span class='kw'>def</span> <span class='id identifier rubyid_root_document'>root_document</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_root_document_id'>root_document_id</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='kw'>self</span>
  <span class='kw'>else</span>
    <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_root_document_id'>root_document_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_next_doc-instance_method">
  
    - (<tt>Object</tt>) <strong>set_next_doc</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Use the information in self.parent.subdoc_refs to set the previous document
link.  Thus, if @foo and @bar are subdocuments in order of @article, then
after the call @foo.set_next_doc,</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 252</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_next_doc'>set_next_doc</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_doc_refs'>doc_refs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>next</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_next_id'>next_id</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_persist'>persist</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_previous_doc-instance_method">
  
    - (<tt>Object</tt>) <strong>set_previous_doc</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Use the information in self.parent.subdoc_refs to set the previous document
link.  Thus, if @foo and @bar are subdocuments in order of @article, then
after the call @bar.set_previous_doc,</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244
245</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_previous_doc'>set_previous_doc</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_doc_refs'>doc_refs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>previous</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_previous_id'>previous_id</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_persist'>persist</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="status-instance_method">
  
    - (<tt>Object</tt>) <strong>status</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return title, id, an ids of previous and next documents</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 220</span>

<span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='embexpr_end'>}</span><span class='tstring_content'>:: id: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='embexpr_end'>}</span><span class='tstring_content'>, parent: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='embexpr_end'>}</span><span class='tstring_content'>, back: </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_doc_refs'>doc_refs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>previous</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>, next: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@self</span><span class='period'>.</span><span class='id identifier rubyid_doc_refs'>doc_refs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>next</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="subdocument-instance_method">
  
    - (<tt>Object</tt>) <strong>subdocument</strong>(k) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>*doc.subdocment(k)* returns the k-th subdocument of <strong>doc</strong></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


265
266
267</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 265</span>

<span class='kw'>def</span> <span class='id identifier rubyid_subdocument'>subdocument</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_content-instance_method">
  
    - (<tt>Object</tt>) <strong>update_content</strong>(input = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If input is nil, render the content and save it in rendered_content. 
Otherwise, Replace #content by str, render it and save itl. .</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


317
318
319
320
321
322
323
324
325
326
327</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 317</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_content'>update_content</span><span class='lparen'>(</span><span class='id identifier rubyid_input'>input</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input'>input</span> <span class='op'>==</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_input'>input</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_renderer'>renderer</span> <span class='op'>=</span> <span class='const'>Render</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rendered_content'>rendered_content</span> <span class='op'>=</span> <span class='id identifier rubyid_renderer'>renderer</span><span class='period'>.</span><span class='id identifier rubyid_convert'>convert</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_neighbors-instance_method">
  
    - (<tt>Object</tt>) <strong>update_neighbors</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Used by #insert to preserve the validity of the previous and next links of
subdocuments.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134
135
136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 132</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_neighbors'>update_neighbors</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_previous_doc'>set_previous_doc</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_next_doc'>set_next_doc</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_previous_document'>previous_document</span>
    <span class='id identifier rubyid_previous_document'>previous_document</span><span class='period'>.</span><span class='id identifier rubyid_set_next_doc'>set_next_doc</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_next_document'>next_document</span>
    <span class='id identifier rubyid_next_document'>next_document</span><span class='period'>.</span><span class='id identifier rubyid_set_previous_doc'>set_previous_doc</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_table_of_contents-instance_method">
  
    - (<tt>Object</tt>) <strong>update_table_of_contents</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A table of contents is a list of lists, where the sublists are oof the form
[id, title].  #update_table_of_contents creates this list from scratch,
then stores it as jsonb in the toc field of the database</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


355
356
357
358
359
360
361
362
363</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/noteshare/entities/ns_document.rb', line 355</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_table_of_contents'>update_table_of_contents</span>
  <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_subdoc_refs'>subdoc_refs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='op'>|</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_toc'>toc</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='const'>DocumentRepository</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sat Oct 24 12:59:41 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.3).
</div>

  </body>
</html>